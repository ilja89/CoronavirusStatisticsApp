Imports System.Math
Imports Map
Public Class mapDebug
    Private ps As Size = New Size(1920, 1200)
    Private polygons As New List(Of CPolygon)
    Private curPoints As New List(Of Point)
    Private Sub WhenLoaded() Handles Me.Load
        polygons.Add(New CPolygon(
stringToPoints("775,773,749,784,733,803,721,788,710,768,696,760,677,751,657,743,653,728,644,741,631,732,619,710,612,681,610,655,600,640,615,635,631,637,663,625,677,625,671,608,671,593,693,599,695,580,693,565,710,562,739,554,802,565,828,562,835,547,857,530,866,545,894,534,902,519,940,532,950,517,959,554,977,560,988,547,1005,543,1021,534,1048,537,1065,535,1066,556,1059,580,1048,607,1027,623,1003,650,989,681,985,717,983,743,992,756,1017,758,1036,769,1059,784,1059,799,1062,820,1039,820,1023,842,1014,863,1000,876,1000,897,997,912,989,927,949,938,918,942,903,959,882,962,863,957,843,970,828,1000,807,1000,819,966,829,929,846,902,844,871,841,841,847,807,864,784,875,764,872,747,852,728,831,715,814,713,798,717,783,730,784,749"),
        mpb))
        polygons.Add(New CPolygon(
stringToPoints("775,773,749,784,733,803,721,788,710,768,696,760,677,751,657,743,653,728,644,741,631,732,619,710,612,681,610,655,600,640,615,635,631,637,663,625,677,625,671,608,671,593,693,599,695,580,693,565,710,562,739,554,802,565,828,562,835,547,857,530,866,545,894,534,902,519,940,532,950,517,959,554,977,560,988,547,1005,543,1021,534,1048,537,1065,535,1066,556,1059,580,1048,607,1027,623,1003,650,989,681,985,717,983,743,992,756,1017,758,1036,769,1059,784,1059,799,1062,820,1039,820,1023,842,1014,863,1000,876,1000,897,997,912,989,927,949,938,918,942,903,959,882,962,863,957,843,970,828,1000,807,1000,819,966,829,929,846,902,844,871,841,841,847,807,864,784,875,764,872,747,852,728,831,715,814,713,798,717,783,730,784,749"),
        mpb))
        polygons.Add(New CPolygon(
        stringToPoints("600,640,559,622,557,577,570,532,603,520,598,496,570,505,545,507,539,490,551,477,541,434,536,416,577,402,553,386,538,369,538,335,563,324,557,262,607,243,628,249,621,264,621,264,633,277,653,292,675,305,689,307,705,307,728,320,734,337,728,356,719,389,727,419,734,438,736,466,730,489,724,502,721,524,736,537,739,554,710,562,693,565,695,580,693,599,671,593,671,608,677,625,663,625,631,637,615,635"),
        mpb))
        polygons.Add(New CPolygon(
stringToPoints("653,215,639,225,621,264,633,277,653,292,675,305,689,307,705,307,728,320,734,337,728,356,719,389,737,373,754,354,773,365,787,358,799,331,823,326,841,322,858,320,863,288,869,262,891,256,918,256,940,253,956,253,967,279,973,294,995,298,1005,315,1021,322,1039,324,1045,337,1060,359,1077,371,1094,361,1095,348,1100,324,1115,320,1116,301,1116,273,1128,256,1125,238,1121,219,1144,221,1162,223,1198,208,1225,202,1240,206,1236,183,1230,146,1218,118,1212,86,1202,67,1198,47,1196,34,1190,13,1177,11,1127,7,985,26,911,52,846,52,715,157,690,174,660,180"),
        mpb))
        polygons.Add(New CPolygon(
stringToPoints("1042,481,1044,519,1021,534,1005,543,988,547,977,560,959,554,940,532,940,532,902,519,894,534,866,545,857,530,835,547,828,562,802,565,739,554,736,537,721,524,724,502,730,489,736,466,734,438,727,419,719,389,737,373,754,354,773,365,773,365,773,365,799,331,823,326,841,322,858,320,863,288,869,262,891,256,918,256,940,253,940,253,940,253,956,253,967,279,973,294,995,298,1005,315,1005,315,1021,322,1039,324,1045,337,1060,359,1077,371,1073,397,1070,419,1054,431,1056,447,1060,461"),
        mpb))
        polygons.Add(New CPolygon(
stringToPoints("1319,859,1314,842,1319,811,1325,790,1325,777,1329,751,1329,719,1319,700,1319,676,1337,659,1363,642,1381,631,1412,637,1426,625,1455,637,1474,625,1492,614,1523,612,1523,588,1541,573,1560,578,1573,592,1589,578,1582,562,1595,547,1609,541,1618,565,1630,590,1639,618,1639,648,1638,670,1650,691,1665,700,1671,685,1687,693,1696,710,1696,736,1696,754,1705,771,1709,784,1707,798,1684,792,1671,786,1656,773,1633,769,1616,769,1603,781,1591,768,1586,792,1570,790,1554,779,1539,790,1535,809,1508,816,1492,816,1476,833,1467,846,1447,831,1428,833,1408,833,1385,842,1372,846,1358,852,1338,854"),
        mpb))
        polygons.Add(New CPolygon(
stringToPoints("1218,972,1202,977,1184,968,1169,944,1183,904,1183,904,1201,904,1213,884,1234,863,1234,863,1239,841,1252,842,1273,861,1292,854,1319,859,1338,854,1358,852,1372,846,1385,842,1408,833,1428,833,1447,831,1467,846,1458,872,1452,887,1458,910,1455,925,1456,944,1440,944,1423,947,1406,947,1400,964,1402,979,1406,1000,1409,1018,1415,1035,1435,1041,1432,1061,1429,1086,1432,1108,1425,1123,1432,1144,1421,1159,1406,1159,1385,1149,1375,1131,1366,1114,1352,1099,1340,1078,1304,1048,1308,1024,1310,998,1293,1002,1258,1002,1236,996"),
        mpb))
        polygons.Add(New CPolygon(
stringToPoints("1500,949,1479,955,1456,944,1455,925,1458,910,1452,887,1458,872,1476,833,1476,833,1492,816,1508,816,1535,809,1539,790,1554,779,1570,790,1586,792,1591,768,1603,781,1616,769,1633,769,1656,773,1671,786,1684,792,1709,784,1719,814,1727,842,1742,863,1752,889,1761,906,1778,912,1780,934,1807,964,1823,970,1816,992,1802,994,1766,998,1749,1000,1712,1000,1696,1000,1683,1000,1675,983,1678,964,1660,966,1625,953,1618,934,1601,938,1600,957,1586,960,1570,944,1559,957,1544,957,1527,957"),
        mpb))
        polygons.Add(New CPolygon(
stringToPoints("1482,1185,1468,1187,1450,1181,1432,1144,1425,1123,1432,1108,1429,1086,1432,1061,1435,1041,1415,1035,1409,1018,1406,1000,1402,979,1400,964,1406,947,1423,947,1440,944,1456,944,1479,955,1500,949,1527,957,1544,957,1559,957,1570,944,1586,960,1600,957,1601,938,1618,934,1625,953,1660,966,1678,964,1675,983,1675,983,1683,1000,1696,1000,1712,1000,1749,1000,1746,1020,1728,1030,1742,1063,1722,1065,1709,1082,1696,1091,1701,1110,1707,1123,1692,1136,1684,1151,1693,1172,1675,1166,1654,1159,1616,1149,1588,1134,1565,1123,1550,1146,1524,1146,1492,1161"),
        mpb))
        polygons.Add(New CPolygon(
stringToPoints("1573,490,1609,541,1595,547,1582,562,1589,578,1573,592,1560,578,1541,573,1523,588,1523,612,1492,614,1474,625,1455,637,1426,625,1412,637,1381,631,1363,642,1337,659,1319,676,1311,659,1286,650,1278,625,1257,605,1224,601,1224,601,1210,575,1210,575,1210,560,1210,560,1216,537,1231,519,1249,502,1260,517,1267,498,1272,485,1292,466,1319,457,1319,438,1352,429,1367,423,1378,446,1400,427,1411,414,1417,401,1446,395,1471,391,1486,417,1499,429,1523,423,1538,432,1542,451,1547,481"),
        mpb))
        polygons.Add(New CPolygon(
stringToPoints("1317,47,1278,39,1270,24,1257,24,1258,49,1240,49,1225,56,1212,86,1218,118,1230,146,1236,183,1240,206,1225,202,1198,208,1144,221,1144,221,1121,219,1125,238,1165,264,1195,256,1224,262,1245,262,1264,273,1254,290,1246,307,1246,344,1264,343,1286,346,1286,359,1308,374,1320,397,1319,438,1352,429,1367,423,1378,446,1400,427,1411,414,1417,401,1446,395,1471,391,1488,373,1500,337,1500,301,1529,273,1529,247,1505,223,1488,230,1474,217,1477,197,1492,170,1471,167,1467,146,1482,127,1486,101,1476,75,1452,67,1438,60,1431,77,1399,82,1375,62"),
        mpb))
        polygons.Add(New CPolygon(
stringToPoints("1059,580,1082,593,1106,590,1130,588,1153,577,1180,563,1210,560,1210,575,1224,601,1257,605,1278,625,1286,650,1311,659,1319,676,1319,700,1329,719,1329,751,1325,777,1325,790,1319,811,1314,842,1319,859,1292,854,1273,861,1252,842,1239,841,1234,863,1213,884,1201,904,1183,904,1169,944,1139,944,1127,925,1110,917,1095,904,1079,885,1071,910,1080,934,1056,930,1051,908,1047,889,997,912,1000,897,1000,876,1014,863,1023,842,1039,820,1062,820,1059,799,1059,784,1036,769,1017,758,992,756,983,743,985,717,989,681,1003,650,1027,623,1048,607"),
        mpb))
        Redraw()
    End Sub
    Private Sub mpb_Click(sender As Object, e As MouseEventArgs) Handles mpb.Click
        Dim clickCoords As New Point(CInt((e.X * ps.Width / mpb.Width)), CInt((e.Y * ps.Height / mpb.Height)))
        coords.Text = "X " + clickCoords.X.ToString + " Y " + clickCoords.Y.ToString
        If (Not PointOfExistingPolygon(clickCoords, curPoints) And NotNearToExisting(clickCoords)) Then
            curPoints.Add(clickCoords)
        End If
        Redraw()
    End Sub
    Private Sub Redraw()
        mpb.Image = PictureBox1.Image.Clone
        For Each polygon As CPolygon In polygons
            polygon.Draw(mpb, False, New Pen(Brushes.Black, 4))
        Next
        Dim g As Graphics = Graphics.FromImage(mpb.Image)
        If (curPoints.Count - 1 >= 0) Then
            Dim i As Integer = curPoints.Count - 1
            For j As Integer = 0 To curPoints.Count - 1
                g.DrawLine(Pens.Green, curPoints(i), curPoints(j))
                i = j
            Next
            For j As Integer = 0 To curPoints.Count - 1
                g.DrawEllipse(Pens.Red,
                              New RectangleF(curPoints(j) - New Point(4, 4), New SizeF(8, 8)))
            Next
        End If
        For Each p As CPolygon In polygons
            For j As Integer = 0 To p.Points.Length - 1
                g.FillEllipse(Brushes.Red,
                              New RectangleF(p.Points(j) - New Point(4, 4), New SizeF(8, 8)))
            Next
        Next
    End Sub
    Private Function PointOfExistingPolygon(newPoint As Point, ByRef list As List(Of Point))
        For Each p As CPolygon In polygons
            For Each point As Point In p.Points
                If (Abs(point.X - newPoint.X) < 13 AndAlso Abs(point.Y - newPoint.Y) < 13) Then
                    list.Add(point)
                    Return True
                End If
            Next
        Next
        Return False
    End Function
    Private Function NotNearToExisting(newPoint As Point)
        For Each point As Point In curPoints
            If (Abs(point.X - newPoint.X) < 13 AndAlso Abs(point.Y - newPoint.Y) < 13) Then
                Return False
            End If
        Next
        Return True
    End Function
    Private Function stringToPoints(input As String) As Point()
        Dim pointsList As New List(Of Point)
        Dim splitted = input.Split(",")
        Dim i As Integer = 0
        Dim c As Integer = 0
        Dim points(splitted.Length / 2 - 1) As Point
        If (splitted.Length = 1) Then
            Return points
        End If
        While (i < splitted.Length)
            points(c) = New Point(splitted(i), splitted(i + 1))
            c = c + 1
            i = i + 2
        End While
        Return points
    End Function

    Private Sub outPointsButton_Click(sender As Object, e As EventArgs) Handles outPointsButton.Click
        richTb.Text = ""
        For Each point As Point In curPoints
            richTb.Text += point.X.ToString + "," + point.Y.ToString + ","
        Next
    End Sub

    Private Sub removeLastButton_Click(sender As Object, e As EventArgs) Handles removeLastButton.Click
        If (curPoints.Count > 0) Then
            curPoints.RemoveAt(curPoints.Count - 1)
        End If
        Redraw()
    End Sub
End Class